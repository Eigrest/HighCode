

BEGIN TRY

MERGE INTO [Bank_Holidays] AS Target
USING (VALUES
  (N'D396EB64-0374-46D8-89FD-AE621C132EA0',N'Mother''s Day','2019-05-05T00:00:00')
 ,(N'C2BFF6F0-3DB6-4A1D-B75F-F604F5932846',N'Holy Monday','2019-04-22T00:00:00')
 ,(N'C2BFF6F0-3DB6-4A2D-B75F-F604F5932846',N'Holy Thursday','2019-04-19T00:00:00')
 ,(N'C2BFF6F0-3DB6-4A3D-B75F-F604F5932846',N'Worker''s Day','2019-05-01T00:00:00')
 ,(N'C2BFF6F0-3DB6-4A4D-B75F-F604F5932846',N'Easter Day','2019-04-29T00:00:00')
 ,(N'C2BFF6F0-3DB6-4A5D-B75F-F604F5932846',N'Day of San Juan','2019-06-24T00:00:00')
) AS Source ([IdHoliday],[Name],[Date])
ON (Target.[IdHoliday] = Source.[IdHoliday])
WHEN MATCHED AND (
	NULLIF(Source.[Name], Target.[Name]) IS NOT NULL OR NULLIF(Target.[Name], Source.[Name]) IS NOT NULL OR 
	NULLIF(Source.[Date], Target.[Date]) IS NOT NULL OR NULLIF(Target.[Date], Source.[Date]) IS NOT NULL) THEN
 UPDATE SET
  [Name] = Source.[Name], 
  [Date] = Source.[Date]
WHEN NOT MATCHED BY TARGET THEN
 INSERT([IdHoliday],[Name],[Date])
 VALUES(Source.[IdHoliday],Source.[Name],Source.[Date])
WHEN NOT MATCHED BY SOURCE THEN 
 DELETE
;
END TRY
BEGIN CATCH
    DECLARE @ERRORNUMBER	INT,@ERRORMSG		VARCHAR(MAX),@ERRORSTATE		INT
    SELECT @ERRORNUMBER = 50000 + ERROR_NUMBER(),@ERRORMSG = ERROR_MESSAGE(), @ERRORSTATE = ERROR_STATE();
    THROW @ERRORNUMBER, @ERRORMSG, @ERRORSTATE
END CATCH
GO





