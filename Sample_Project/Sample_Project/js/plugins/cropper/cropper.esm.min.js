import $ from"jquery";var DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',REGEXP_DATA_URL_HEAD=/^data:.*,/,REGEXP_USERAGENT=/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i,navigator="undefined"!=typeof window?window.navigator:null,IS_SAFARI_OR_UIWEBVIEW=navigator&&REGEXP_USERAGENT.test(navigator.userAgent),fromCharCode=String.fromCharCode;function isNumber(n){return"number"==typeof n&&!isNaN(n)}function isUndefined(n){return void 0===n}function toArray(obj,offset){var args=[];return isNumber(offset)&&args.push(offset),args.slice.apply(obj,args)}function proxy(fn,context){for(var _len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_key<_len;_key++)args[_key-2]=arguments[_key];return function(){for(var _len2=arguments.length,args2=Array(_len2),_key2=0;_key2<_len2;_key2++)args2[_key2]=arguments[_key2];return fn.apply(context,args.concat(toArray(args2)))}}function objectKeys(obj){var keys=[];return $.each(obj,function(key){keys.push(key)}),keys}function isCrossOriginURL(url){var parts=url.match(/^(https?:)\/\/([^:\/?#]+):?(\d*)/i);return parts&&(parts[1]!==location.protocol||parts[2]!==location.hostname||parts[3]!==location.port)}function addTimestamp(url){var timestamp="timestamp="+(new Date).getTime();return url+(-1===url.indexOf("?")?"?":"&")+timestamp}function getImageSize(image,callback){if(!image.naturalWidth||IS_SAFARI_OR_UIWEBVIEW){var newImage=document.createElement("img");newImage.onload=function(){callback(this.width,this.height)},newImage.src=image.src}else callback(image.naturalWidth,image.naturalHeight)}function getTransform(options){var transforms=[],translateX=options.translateX,translateY=options.translateY,rotate=options.rotate,scaleX=options.scaleX,scaleY=options.scaleY;return isNumber(translateX)&&0!==translateX&&transforms.push("translateX("+translateX+"px)"),isNumber(translateY)&&0!==translateY&&transforms.push("translateY("+translateY+"px)"),isNumber(rotate)&&0!==rotate&&transforms.push("rotate("+rotate+"deg)"),isNumber(scaleX)&&1!==scaleX&&transforms.push("scaleX("+scaleX+")"),isNumber(scaleY)&&1!==scaleY&&transforms.push("scaleY("+scaleY+")"),transforms.length?transforms.join(" "):"none"}function getRotatedSizes(data,isReversed){var deg=Math.abs(data.degree)%180,arc=(deg>90?180-deg:deg)*Math.PI/180,sinArc=Math.sin(arc),cosArc=Math.cos(arc),width=data.width,height=data.height,aspectRatio=data.aspectRatio,newWidth=void 0,newHeight=void 0;return isReversed?newHeight=(newWidth=width/(cosArc+sinArc/aspectRatio))/aspectRatio:(newWidth=width*cosArc+height*sinArc,newHeight=width*sinArc+height*cosArc),{width:newWidth,height:newHeight}}function getSourceCanvas(image,data){var canvas=$("<canvas>")[0],context=canvas.getContext("2d"),dstX=0,dstY=0,dstWidth=data.naturalWidth,dstHeight=data.naturalHeight,rotate=data.rotate,scaleX=data.scaleX,scaleY=data.scaleY,scalable=isNumber(scaleX)&&isNumber(scaleY)&&(1!==scaleX||1!==scaleY),rotatable=isNumber(rotate)&&0!==rotate,advanced=rotatable||scalable,canvasWidth=dstWidth*Math.abs(scaleX||1),canvasHeight=dstHeight*Math.abs(scaleY||1),translateX=void 0,translateY=void 0,rotated=void 0;return scalable&&(translateX=canvasWidth/2,translateY=canvasHeight/2),rotatable&&(translateX=(canvasWidth=(rotated=getRotatedSizes({width:canvasWidth,height:canvasHeight,degree:rotate})).width)/2,translateY=(canvasHeight=rotated.height)/2),canvas.width=canvasWidth,canvas.height=canvasHeight,advanced&&(dstX=-dstWidth/2,dstY=-dstHeight/2,context.save(),context.translate(translateX,translateY)),rotatable&&context.rotate(rotate*Math.PI/180),scalable&&context.scale(scaleX,scaleY),context.drawImage(image,Math.floor(dstX),Math.floor(dstY),Math.floor(dstWidth),Math.floor(dstHeight)),advanced&&context.restore(),canvas}function getStringFromCharCode(dataView,start,length){var str="",i=void 0;for(i=start,length+=start;i<length;i++)str+=fromCharCode(dataView.getUint8(i));return str}function getOrientation(arrayBuffer){var dataView=new DataView(arrayBuffer),length=dataView.byteLength,orientation=void 0,tiffOffset=void 0,firstIFDOffset=void 0,littleEndian=void 0,endianness=void 0,app1Start=void 0,ifdStart=void 0,offset=void 0,i=void 0;if(255===dataView.getUint8(0)&&216===dataView.getUint8(1))for(offset=2;offset<length;){if(255===dataView.getUint8(offset)&&225===dataView.getUint8(offset+1)){app1Start=offset;break}offset++}if(app1Start&&(tiffOffset=app1Start+10,"Exif"===getStringFromCharCode(dataView,app1Start+4,4)&&((littleEndian=18761===(endianness=dataView.getUint16(tiffOffset)))||19789===endianness)&&42===dataView.getUint16(tiffOffset+2,littleEndian)&&(firstIFDOffset=dataView.getUint32(tiffOffset+4,littleEndian))>=8&&(ifdStart=tiffOffset+firstIFDOffset)),ifdStart)for(length=dataView.getUint16(ifdStart,littleEndian),i=0;i<length;i++)if(offset=ifdStart+12*i+2,274===dataView.getUint16(offset,littleEndian)){offset+=8,orientation=dataView.getUint16(offset,littleEndian),IS_SAFARI_OR_UIWEBVIEW&&dataView.setUint16(offset,1,littleEndian);break}return orientation}function dataURLToArrayBuffer(dataURL){var base64=dataURL.replace(REGEXP_DATA_URL_HEAD,""),binary=atob(base64),length=binary.length,arrayBuffer=new ArrayBuffer(length),dataView=new Uint8Array(arrayBuffer),i=void 0;for(i=0;i<length;i++)dataView[i]=binary.charCodeAt(i);return arrayBuffer}function arrayBufferToDataURL(arrayBuffer){var dataView=new Uint8Array(arrayBuffer),length=dataView.length,base64="",i=void 0;for(i=0;i<length;i++)base64+=fromCharCode(dataView[i]);return"data:image/jpeg;base64,"+btoa(base64)}var render$1={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var options=this.options,$this=this.$element,$container=this.$container,$cropper=this.$cropper,hidden="cropper-hidden";$cropper.addClass(hidden),$this.removeClass(hidden),$cropper.css(this.container={width:Math.max($container.width(),Number(options.minContainerWidth)||200),height:Math.max($container.height(),Number(options.minContainerHeight)||100)}),$this.addClass(hidden),$cropper.removeClass(hidden)},initCanvas:function(){var viewMode=this.options.viewMode,container=this.container,containerWidth=container.width,containerHeight=container.height,image=this.image,imageNaturalWidth=image.naturalWidth,imageNaturalHeight=image.naturalHeight,is90Degree=Math.abs(image.rotate)%180==90,naturalWidth=is90Degree?imageNaturalHeight:imageNaturalWidth,naturalHeight=is90Degree?imageNaturalWidth:imageNaturalHeight,aspectRatio=naturalWidth/naturalHeight,canvasWidth=containerWidth,canvasHeight=containerHeight;containerHeight*aspectRatio>containerWidth?3===viewMode?canvasWidth=containerHeight*aspectRatio:canvasHeight=containerWidth/aspectRatio:3===viewMode?canvasHeight=containerWidth/aspectRatio:canvasWidth=containerHeight*aspectRatio;var canvas={naturalWidth,naturalHeight,aspectRatio,width:canvasWidth,height:canvasHeight};canvas.oldLeft=canvas.left=(containerWidth-canvasWidth)/2,canvas.oldTop=canvas.top=(containerHeight-canvasHeight)/2,this.canvas=canvas,this.limited=1===viewMode||2===viewMode,this.limitCanvas(!0,!0),this.initialImage=$.extend({},image),this.initialCanvas=$.extend({},canvas)},limitCanvas:function(isSizeLimited,isPositionLimited){var options=this.options,viewMode=options.viewMode,container=this.container,containerWidth=container.width,containerHeight=container.height,canvas=this.canvas,aspectRatio=canvas.aspectRatio,cropBox=this.cropBox,cropped=this.cropped&&cropBox;if(isSizeLimited){var minCanvasWidth=Number(options.minCanvasWidth)||0,minCanvasHeight=Number(options.minCanvasHeight)||0;viewMode&&(viewMode>1?(minCanvasWidth=Math.max(minCanvasWidth,containerWidth),minCanvasHeight=Math.max(minCanvasHeight,containerHeight),3===viewMode&&(minCanvasHeight*aspectRatio>minCanvasWidth?minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasHeight=minCanvasWidth/aspectRatio)):minCanvasWidth?minCanvasWidth=Math.max(minCanvasWidth,cropped?cropBox.width:0):minCanvasHeight?minCanvasHeight=Math.max(minCanvasHeight,cropped?cropBox.height:0):cropped&&(minCanvasWidth=cropBox.width,(minCanvasHeight=cropBox.height)*aspectRatio>minCanvasWidth?minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasHeight=minCanvasWidth/aspectRatio)),minCanvasWidth&&minCanvasHeight?minCanvasHeight*aspectRatio>minCanvasWidth?minCanvasHeight=minCanvasWidth/aspectRatio:minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasWidth?minCanvasHeight=minCanvasWidth/aspectRatio:minCanvasHeight&&(minCanvasWidth=minCanvasHeight*aspectRatio),canvas.minWidth=minCanvasWidth,canvas.minHeight=minCanvasHeight,canvas.maxWidth=1/0,canvas.maxHeight=1/0}if(isPositionLimited)if(viewMode){var newCanvasLeft=containerWidth-canvas.width,newCanvasTop=containerHeight-canvas.height;canvas.minLeft=Math.min(0,newCanvasLeft),canvas.minTop=Math.min(0,newCanvasTop),canvas.maxLeft=Math.max(0,newCanvasLeft),canvas.maxTop=Math.max(0,newCanvasTop),cropped&&this.limited&&(canvas.minLeft=Math.min(cropBox.left,cropBox.left+cropBox.width-canvas.width),canvas.minTop=Math.min(cropBox.top,cropBox.top+cropBox.height-canvas.height),canvas.maxLeft=cropBox.left,canvas.maxTop=cropBox.top,2===viewMode&&(canvas.width>=containerWidth&&(canvas.minLeft=Math.min(0,newCanvasLeft),canvas.maxLeft=Math.max(0,newCanvasLeft)),canvas.height>=containerHeight&&(canvas.minTop=Math.min(0,newCanvasTop),canvas.maxTop=Math.max(0,newCanvasTop))))}else canvas.minLeft=-canvas.width,canvas.minTop=-canvas.height,canvas.maxLeft=containerWidth,canvas.maxTop=containerHeight},renderCanvas:function(isChanged){var canvas=this.canvas,image=this.image,rotate=image.rotate,naturalWidth=image.naturalWidth,naturalHeight=image.naturalHeight;if(this.rotated){this.rotated=!1;var rotated=getRotatedSizes({width:image.width,height:image.height,degree:rotate}),aspectRatio=rotated.width/rotated.height,isSquareImage=1===image.aspectRatio;if(isSquareImage||aspectRatio!==canvas.aspectRatio){if(canvas.left-=(rotated.width-canvas.width)/2,canvas.top-=(rotated.height-canvas.height)/2,canvas.width=rotated.width,canvas.height=rotated.height,canvas.aspectRatio=aspectRatio,canvas.naturalWidth=naturalWidth,canvas.naturalHeight=naturalHeight,isSquareImage&&rotate%90||rotate%180){var rotated2=getRotatedSizes({width:naturalWidth,height:naturalHeight,degree:rotate});canvas.naturalWidth=rotated2.width,canvas.naturalHeight=rotated2.height}this.limitCanvas(!0,!1)}}(canvas.width>canvas.maxWidth||canvas.width<canvas.minWidth)&&(canvas.left=canvas.oldLeft),(canvas.height>canvas.maxHeight||canvas.height<canvas.minHeight)&&(canvas.top=canvas.oldTop),canvas.width=Math.min(Math.max(canvas.width,canvas.minWidth),canvas.maxWidth),canvas.height=Math.min(Math.max(canvas.height,canvas.minHeight),canvas.maxHeight),this.limitCanvas(!1,!0),canvas.oldLeft=canvas.left=Math.min(Math.max(canvas.left,canvas.minLeft),canvas.maxLeft),canvas.oldTop=canvas.top=Math.min(Math.max(canvas.top,canvas.minTop),canvas.maxTop),this.$canvas.css({width:canvas.width,height:canvas.height,transform:getTransform({translateX:canvas.left,translateY:canvas.top})}),this.renderImage(),this.cropped&&this.limited&&this.limitCropBox(!0,!0),isChanged&&this.output()},renderImage:function(isChanged){var canvas=this.canvas,image=this.image,reversed=void 0;image.rotate&&(reversed=getRotatedSizes({width:canvas.width,height:canvas.height,degree:image.rotate,aspectRatio:image.aspectRatio},!0)),$.extend(image,reversed?{width:reversed.width,height:reversed.height,left:(canvas.width-reversed.width)/2,top:(canvas.height-reversed.height)/2}:{width:canvas.width,height:canvas.height,left:0,top:0}),this.$clone.css({width:image.width,height:image.height,transform:getTransform($.extend({translateX:image.left,translateY:image.top},image))}),isChanged&&this.output()},initCropBox:function(){var options=this.options,canvas=this.canvas,aspectRatio=options.aspectRatio,autoCropArea=Number(options.autoCropArea)||.8,cropBox={width:canvas.width,height:canvas.height};aspectRatio&&(canvas.height*aspectRatio>canvas.width?cropBox.height=cropBox.width/aspectRatio:cropBox.width=cropBox.height*aspectRatio),this.cropBox=cropBox,this.limitCropBox(!0,!0),cropBox.width=Math.min(Math.max(cropBox.width,cropBox.minWidth),cropBox.maxWidth),cropBox.height=Math.min(Math.max(cropBox.height,cropBox.minHeight),cropBox.maxHeight),cropBox.width=Math.max(cropBox.minWidth,cropBox.width*autoCropArea),cropBox.height=Math.max(cropBox.minHeight,cropBox.height*autoCropArea),cropBox.oldLeft=cropBox.left=canvas.left+(canvas.width-cropBox.width)/2,cropBox.oldTop=cropBox.top=canvas.top+(canvas.height-cropBox.height)/2,this.initialCropBox=$.extend({},cropBox)},limitCropBox:function(isSizeLimited,isPositionLimited){var options=this.options,aspectRatio=options.aspectRatio,container=this.container,containerWidth=container.width,containerHeight=container.height,canvas=this.canvas,cropBox=this.cropBox,limited=this.limited;if(isSizeLimited){var minCropBoxWidth=Number(options.minCropBoxWidth)||0,minCropBoxHeight=Number(options.minCropBoxHeight)||0,maxCropBoxWidth=Math.min(containerWidth,limited?canvas.width:containerWidth),maxCropBoxHeight=Math.min(containerHeight,limited?canvas.height:containerHeight);minCropBoxWidth=Math.min(minCropBoxWidth,containerWidth),minCropBoxHeight=Math.min(minCropBoxHeight,containerHeight),aspectRatio&&(minCropBoxWidth&&minCropBoxHeight?minCropBoxHeight*aspectRatio>minCropBoxWidth?minCropBoxHeight=minCropBoxWidth/aspectRatio:minCropBoxWidth=minCropBoxHeight*aspectRatio:minCropBoxWidth?minCropBoxHeight=minCropBoxWidth/aspectRatio:minCropBoxHeight&&(minCropBoxWidth=minCropBoxHeight*aspectRatio),maxCropBoxHeight*aspectRatio>maxCropBoxWidth?maxCropBoxHeight=maxCropBoxWidth/aspectRatio:maxCropBoxWidth=maxCropBoxHeight*aspectRatio),cropBox.minWidth=Math.min(minCropBoxWidth,maxCropBoxWidth),cropBox.minHeight=Math.min(minCropBoxHeight,maxCropBoxHeight),cropBox.maxWidth=maxCropBoxWidth,cropBox.maxHeight=maxCropBoxHeight}isPositionLimited&&(limited?(cropBox.minLeft=Math.max(0,canvas.left),cropBox.minTop=Math.max(0,canvas.top),cropBox.maxLeft=Math.min(containerWidth,canvas.left+canvas.width)-cropBox.width,cropBox.maxTop=Math.min(containerHeight,canvas.top+canvas.height)-cropBox.height):(cropBox.minLeft=0,cropBox.minTop=0,cropBox.maxLeft=containerWidth-cropBox.width,cropBox.maxTop=containerHeight-cropBox.height))},renderCropBox:function(){var options=this.options,container=this.container,containerWidth=container.width,containerHeight=container.height,cropBox=this.cropBox;(cropBox.width>cropBox.maxWidth||cropBox.width<cropBox.minWidth)&&(cropBox.left=cropBox.oldLeft),(cropBox.height>cropBox.maxHeight||cropBox.height<cropBox.minHeight)&&(cropBox.top=cropBox.oldTop),cropBox.width=Math.min(Math.max(cropBox.width,cropBox.minWidth),cropBox.maxWidth),cropBox.height=Math.min(Math.max(cropBox.height,cropBox.minHeight),cropBox.maxHeight),this.limitCropBox(!1,!0),cropBox.oldLeft=cropBox.left=Math.min(Math.max(cropBox.left,cropBox.minLeft),cropBox.maxLeft),cropBox.oldTop=cropBox.top=Math.min(Math.max(cropBox.top,cropBox.minTop),cropBox.maxTop),options.movable&&options.cropBoxMovable&&this.$face.data("action",cropBox.width===containerWidth&&cropBox.height===containerHeight?"move":"all"),this.$cropBox.css({width:cropBox.width,height:cropBox.height,transform:getTransform({translateX:cropBox.left,translateY:cropBox.top})}),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.completed&&this.trigger("crop",this.getData())}},DATA_PREVIEW="preview",preview$1={initPreview:function(){var crossOrigin=this.crossOrigin,url=crossOrigin?this.crossOriginUrl:this.url,image=document.createElement("img");crossOrigin&&(image.crossOrigin=crossOrigin),image.src=url;var $clone2=$(image);this.$preview=$(this.options.preview),this.$clone2=$clone2,this.$viewBox.html($clone2),this.$preview.each(function(i,element){var $this=$(element),img=document.createElement("img");$this.data(DATA_PREVIEW,{width:$this.width(),height:$this.height(),html:$this.html()}),crossOrigin&&(img.crossOrigin=crossOrigin),img.src=url,img.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',$this.html(img)})},resetPreview:function(){this.$preview.each(function(i,element){var $this=$(element),data=$this.data(DATA_PREVIEW);$this.css({width:data.width,height:data.height}).html(data.html).removeData(DATA_PREVIEW)})},preview:function(){var image=this.image,canvas=this.canvas,cropBox=this.cropBox,cropBoxWidth=cropBox.width,cropBoxHeight=cropBox.height,width=image.width,height=image.height,left=cropBox.left-canvas.left-image.left,top=cropBox.top-canvas.top-image.top;this.cropped&&!this.disabled&&(this.$clone2.css({width,height,transform:getTransform($.extend({translateX:-left,translateY:-top},image))}),this.$preview.each(function(i,element){var $this=$(element),data=$this.data(DATA_PREVIEW),originalWidth=data.width,originalHeight=data.height,newWidth=originalWidth,newHeight=originalHeight,ratio=1;cropBoxWidth&&(newHeight=cropBoxHeight*(ratio=originalWidth/cropBoxWidth)),cropBoxHeight&&newHeight>originalHeight&&(newWidth=cropBoxWidth*(ratio=originalHeight/cropBoxHeight),newHeight=originalHeight),$this.css({width:newWidth,height:newHeight}).find("img").css({width:width*ratio,height:height*ratio,transform:getTransform($.extend({translateX:-left*ratio,translateY:-top*ratio},image))})}))}},PointerEvent="undefined"!=typeof window?window.PointerEvent:null,EVENT_POINTER_DOWN=PointerEvent?"pointerdown":"touchstart mousedown",EVENT_POINTER_MOVE=PointerEvent?"pointermove":"touchmove mousemove",EVENT_POINTER_UP=PointerEvent?" pointerup pointercancel":"touchend touchcancel mouseup",EVENT_WHEEL="wheel mousewheel DOMMouseScroll",EVENT_DBLCLICK="dblclick",EVENT_RESIZE="resize",EVENT_CROP_START="cropstart",EVENT_CROP_MOVE="cropmove",EVENT_CROP_END="cropend",EVENT_CROP="crop",EVENT_ZOOM="zoom",events={bind:function(){var options=this.options,$this=this.$element,$cropper=this.$cropper;$.isFunction(options.cropstart)&&$this.on(EVENT_CROP_START,options.cropstart),$.isFunction(options.cropmove)&&$this.on(EVENT_CROP_MOVE,options.cropmove),$.isFunction(options.cropend)&&$this.on(EVENT_CROP_END,options.cropend),$.isFunction(options.crop)&&$this.on(EVENT_CROP,options.crop),$.isFunction(options.zoom)&&$this.on(EVENT_ZOOM,options.zoom),$cropper.on(EVENT_POINTER_DOWN,proxy(this.cropStart,this)),options.zoomable&&options.zoomOnWheel&&$cropper.on(EVENT_WHEEL,proxy(this.wheel,this)),options.toggleDragModeOnDblclick&&$cropper.on(EVENT_DBLCLICK,proxy(this.dblclick,this)),$(document).on(EVENT_POINTER_MOVE,this.onCropMove=proxy(this.cropMove,this)).on(EVENT_POINTER_UP,this.onCropEnd=proxy(this.cropEnd,this)),options.responsive&&$(window).on(EVENT_RESIZE,this.onResize=proxy(this.resize,this))},unbind:function(){var options=this.options,$this=this.$element,$cropper=this.$cropper;$.isFunction(options.cropstart)&&$this.off(EVENT_CROP_START,options.cropstart),$.isFunction(options.cropmove)&&$this.off(EVENT_CROP_MOVE,options.cropmove),$.isFunction(options.cropend)&&$this.off(EVENT_CROP_END,options.cropend),$.isFunction(options.crop)&&$this.off(EVENT_CROP,options.crop),$.isFunction(options.zoom)&&$this.off(EVENT_ZOOM,options.zoom),$cropper.off(EVENT_POINTER_DOWN,this.cropStart),options.zoomable&&options.zoomOnWheel&&$cropper.off(EVENT_WHEEL,this.wheel),options.toggleDragModeOnDblclick&&$cropper.off(EVENT_DBLCLICK,this.dblclick),$(document).off(EVENT_POINTER_MOVE,this.onCropMove).off(EVENT_POINTER_UP,this.onCropEnd),options.responsive&&$(window).off(EVENT_RESIZE,this.onResize)}},REGEXP_ACTIONS=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/;function getPointer(_ref,endOnly){var pageX=_ref.pageX,pageY=_ref.pageY,end={endX:pageX,endY:pageY};return endOnly?end:$.extend({startX:pageX,startY:pageY},end)}var handlers={resize:function(){var self=this,options=self.options,$container=self.$container,container=self.container,minContainerWidth=Number(options.minContainerWidth)||200,minContainerHeight=Number(options.minContainerHeight)||100;if(!self.disabled&&container.width!==minContainerWidth&&container.height!==minContainerHeight){var canvasData,cropBoxData,ratio=$container.width()/container.width;1===ratio&&$container.height()===container.height||(canvasData=void 0,cropBoxData=void 0,options.restore&&(canvasData=self.getCanvasData(),cropBoxData=self.getCropBoxData()),self.render(),options.restore&&(self.setCanvasData($.each(canvasData,function(i,n){canvasData[i]=n*ratio})),self.setCropBoxData($.each(cropBoxData,function(i,n){cropBoxData[i]=n*ratio}))))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(this.$dragBox.hasClass("cropper-crop")?"move":"crop")},wheel:function(event){var self=this,e=event.originalEvent||event,ratio=Number(self.options.wheelZoomRatio)||.1;if(!self.disabled&&(event.preventDefault(),!self.wheeling)){self.wheeling=!0,setTimeout(function(){self.wheeling=!1},50);var delta=1;e.deltaY?delta=e.deltaY>0?1:-1:e.wheelDelta?delta=-e.wheelDelta/120:e.detail&&(delta=e.detail>0?1:-1),self.zoom(-delta*ratio,event)}},cropStart:function(e){if(!this.disabled){var options=this.options,pointers=this.pointers,originalEvent=e.originalEvent,action=void 0;originalEvent&&originalEvent.changedTouches?$.each(originalEvent.changedTouches,function(i,touch){pointers[touch.identifier]=getPointer(touch)}):pointers[originalEvent&&originalEvent.pointerId||0]=getPointer(originalEvent||e),action=objectKeys(pointers).length>1&&options.zoomable&&options.zoomOnTouch?"zoom":$(e.target).data("action"),REGEXP_ACTIONS.test(action)&&(this.trigger("cropstart",{originalEvent,action}).isDefaultPrevented()||(e.preventDefault(),this.action=action,this.cropping=!1,"crop"===action&&(this.cropping=!0,this.$dragBox.addClass("cropper-modal"))))}},cropMove:function(e){var action=this.action;if(!this.disabled&&action){var pointers=this.pointers,originalEvent=e.originalEvent;e.preventDefault(),this.trigger("cropmove",{originalEvent,action}).isDefaultPrevented()||(originalEvent&&originalEvent.changedTouches?$.each(originalEvent.changedTouches,function(i,touch){$.extend(pointers[touch.identifier],getPointer(touch,!0))}):$.extend(pointers[originalEvent&&originalEvent.pointerId||0],getPointer(originalEvent||e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var action=this.action,pointers=this.pointers,originalEvent=e.originalEvent;originalEvent&&originalEvent.changedTouches?$.each(originalEvent.changedTouches,function(i,touch){delete pointers[touch.identifier]}):delete pointers[originalEvent&&originalEvent.pointerId||0],action&&(e.preventDefault(),objectKeys(pointers).length||(this.action=""),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass("cropper-modal",this.cropped&&this.options.modal)),this.trigger("cropend",{originalEvent,action}))}}},ACTION_EAST="e",ACTION_WEST="w",ACTION_SOUTH="s",ACTION_NORTH="n",ACTION_SOUTH_EAST="se",ACTION_SOUTH_WEST="sw",ACTION_NORTH_EAST="ne",ACTION_NORTH_WEST="nw";function getMaxZoomRatio(pointers){var pointers2=$.extend({},pointers),ratios=[];return $.each(pointers,function(pointerId,pointer){delete pointers2[pointerId],$.each(pointers2,function(pointerId2,pointer2){var x1=Math.abs(pointer.startX-pointer2.startX),y1=Math.abs(pointer.startY-pointer2.startY),x2=Math.abs(pointer.endX-pointer2.endX),y2=Math.abs(pointer.endY-pointer2.endY),z1=Math.sqrt(x1*x1+y1*y1),ratio=(Math.sqrt(x2*x2+y2*y2)-z1)/z1;ratios.push(ratio)})}),ratios.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),ratios[0]}var change$1={change:function(e){var options=this.options,pointers=this.pointers,pointer=pointers[objectKeys(pointers)[0]],container=this.container,canvas=this.canvas,cropBox=this.cropBox,action=this.action,aspectRatio=options.aspectRatio,width=cropBox.width,height=cropBox.height,left=cropBox.left,top=cropBox.top,right=left+width,bottom=top+height,minLeft=0,minTop=0,maxWidth=container.width,maxHeight=container.height,renderable=!0,offset=void 0;!aspectRatio&&e.shiftKey&&(aspectRatio=width&&height?width/height:1),this.limited&&(minLeft=cropBox.minLeft,minTop=cropBox.minTop,maxWidth=minLeft+Math.min(container.width,canvas.width,canvas.left+canvas.width),maxHeight=minTop+Math.min(container.height,canvas.height,canvas.top+canvas.height));var range={x:pointer.endX-pointer.startX,y:pointer.endY-pointer.startY};switch(aspectRatio&&(range.X=range.y*aspectRatio,range.Y=range.x/aspectRatio),action){case"all":left+=range.x,top+=range.y;break;case ACTION_EAST:if(range.x>=0&&(right>=maxWidth||aspectRatio&&(top<=minTop||bottom>=maxHeight))){renderable=!1;break}width+=range.x,aspectRatio&&(height=width/aspectRatio,top-=range.Y/2),width<0&&(action=ACTION_WEST,width=0);break;case ACTION_NORTH:if(range.y<=0&&(top<=minTop||aspectRatio&&(left<=minLeft||right>=maxWidth))){renderable=!1;break}height-=range.y,top+=range.y,aspectRatio&&(width=height*aspectRatio,left+=range.X/2),height<0&&(action=ACTION_SOUTH,height=0);break;case ACTION_WEST:if(range.x<=0&&(left<=minLeft||aspectRatio&&(top<=minTop||bottom>=maxHeight))){renderable=!1;break}width-=range.x,left+=range.x,aspectRatio&&(height=width/aspectRatio,top+=range.Y/2),width<0&&(action=ACTION_EAST,width=0);break;case ACTION_SOUTH:if(range.y>=0&&(bottom>=maxHeight||aspectRatio&&(left<=minLeft||right>=maxWidth))){renderable=!1;break}height+=range.y,aspectRatio&&(width=height*aspectRatio,left-=range.X/2),height<0&&(action=ACTION_NORTH,height=0);break;case ACTION_NORTH_EAST:if(aspectRatio){if(range.y<=0&&(top<=minTop||right>=maxWidth)){renderable=!1;break}height-=range.y,top+=range.y,width=height*aspectRatio}else range.x>=0?right<maxWidth?width+=range.x:range.y<=0&&top<=minTop&&(renderable=!1):width+=range.x,range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);width<0&&height<0?(action=ACTION_SOUTH_WEST,height=0,width=0):width<0?(action=ACTION_NORTH_WEST,width=0):height<0&&(action=ACTION_SOUTH_EAST,height=0);break;case ACTION_NORTH_WEST:if(aspectRatio){if(range.y<=0&&(top<=minTop||left<=minLeft)){renderable=!1;break}height-=range.y,top+=range.y,width=height*aspectRatio,left+=range.X}else range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y<=0&&top<=minTop&&(renderable=!1):(width-=range.x,left+=range.x),range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);width<0&&height<0?(action=ACTION_SOUTH_EAST,height=0,width=0):width<0?(action=ACTION_NORTH_EAST,width=0):height<0&&(action=ACTION_SOUTH_WEST,height=0);break;case ACTION_SOUTH_WEST:if(aspectRatio){if(range.x<=0&&(left<=minLeft||bottom>=maxHeight)){renderable=!1;break}width-=range.x,left+=range.x,height=width/aspectRatio}else range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y>=0&&bottom>=maxHeight&&(renderable=!1):(width-=range.x,left+=range.x),range.y>=0?bottom<maxHeight&&(height+=range.y):height+=range.y;width<0&&height<0?(action=ACTION_NORTH_EAST,height=0,width=0):width<0?(action=ACTION_SOUTH_EAST,width=0):height<0&&(action=ACTION_NORTH_WEST,height=0);break;case ACTION_SOUTH_EAST:if(aspectRatio){if(range.x>=0&&(right>=maxWidth||bottom>=maxHeight)){renderable=!1;break}height=(width+=range.x)/aspectRatio}else range.x>=0?right<maxWidth?width+=range.x:range.y>=0&&bottom>=maxHeight&&(renderable=!1):width+=range.x,range.y>=0?bottom<maxHeight&&(height+=range.y):height+=range.y;width<0&&height<0?(action=ACTION_NORTH_WEST,height=0,width=0):width<0?(action=ACTION_SOUTH_WEST,width=0):height<0&&(action=ACTION_NORTH_EAST,height=0);break;case"move":this.move(range.x,range.y),renderable=!1;break;case"zoom":this.zoom(getMaxZoomRatio(pointers),e.originalEvent),renderable=!1;break;case"crop":if(!range.x||!range.y){renderable=!1;break}offset=this.$cropper.offset(),left=pointer.startX-offset.left,top=pointer.startY-offset.top,width=cropBox.minWidth,height=cropBox.minHeight,range.x>0?action=range.y>0?ACTION_SOUTH_EAST:ACTION_NORTH_EAST:range.x<0&&(left-=width,action=range.y>0?ACTION_SOUTH_WEST:ACTION_NORTH_WEST),range.y<0&&(top-=height),this.cropped||(this.$cropBox.removeClass("cropper-hidden"),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}renderable&&(cropBox.width=width,cropBox.height=height,cropBox.left=left,cropBox.top=top,this.action=action,this.renderCropBox()),$.each(pointers,function(i,p){p.startX=p.endX,p.startY=p.endY})}},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0},set=function set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);null!==parent&&set(parent,property,value,receiver)}else if("value"in desc&&desc.writable)desc.value=value;else{var setter=desc.set;void 0!==setter&&setter.call(receiver,value)}return value},toConsumableArray=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)};function getPointersCenter(pointers){var pageX=0,pageY=0,count=0;return $.each(pointers,function(i,_ref){var startX=_ref.startX,startY=_ref.startY;pageX+=startX,pageY+=startY,count+=1}),{pageX:pageX/=count,pageY:pageY/=count}}var methods={crop:function(){this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass("cropper-modal"),this.$cropBox.removeClass("cropper-hidden")),this.setCropBoxData(this.initialCropBox))},reset:function(){this.ready&&!this.disabled&&(this.image=$.extend({},this.initialImage),this.canvas=$.extend({},this.initialCanvas),this.cropBox=$.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&($.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass("cropper-modal"),this.$cropBox.addClass("cropper-hidden"))},replace:function(url,onlyColorChanged){!this.disabled&&url&&(this.isImg&&this.$element.attr("src",url),onlyColorChanged?(this.url=url,this.$clone.attr("src",url),this.ready&&this.$preview.find("img").add(this.$clone2).attr("src",url)):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(url)))},enable:function(){this.ready&&(this.disabled=!1,this.$cropper.removeClass("cropper-disabled"))},disable:function(){this.ready&&(this.disabled=!0,this.$cropper.addClass("cropper-disabled"))},destroy:function(){var $this=this.$element;this.loaded?(this.isImg&&this.replaced&&$this.attr("src",this.originalUrl),this.unbuild(),$this.removeClass("cropper-hidden")):this.isImg?$this.off("load",this.start):this.$clone&&this.$clone.remove(),$this.removeData("cropper")},move:function(offsetX,offsetY){var canvas=this.canvas;this.moveTo(isUndefined(offsetX)?offsetX:canvas.left+Number(offsetX),isUndefined(offsetY)?offsetY:canvas.top+Number(offsetY))},moveTo:function(x,y){var canvas=this.canvas,changed=!1;isUndefined(y)&&(y=x),x=Number(x),y=Number(y),this.ready&&!this.disabled&&this.options.movable&&(isNumber(x)&&(canvas.left=x,changed=!0),isNumber(y)&&(canvas.top=y,changed=!0),changed&&this.renderCanvas(!0))},zoom:function(ratio,_event){var canvas=this.canvas;ratio=(ratio=Number(ratio))<0?1/(1-ratio):1+ratio,this.zoomTo(canvas.width*ratio/canvas.naturalWidth,_event)},zoomTo:function(ratio,_event){var options=this.options,pointers=this.pointers,canvas=this.canvas,width=canvas.width,height=canvas.height,naturalWidth=canvas.naturalWidth,naturalHeight=canvas.naturalHeight;if((ratio=Number(ratio))>=0&&this.ready&&!this.disabled&&options.zoomable){var newWidth=naturalWidth*ratio,newHeight=naturalHeight*ratio,originalEvent=void 0;if(_event&&(originalEvent=_event.originalEvent),this.trigger("zoom",{originalEvent,oldRatio:width/naturalWidth,ratio:newWidth/naturalWidth}).isDefaultPrevented())return;if(originalEvent){var offset=this.$cropper.offset(),center=pointers&&objectKeys(pointers).length?getPointersCenter(pointers):{pageX:_event.pageX||originalEvent.pageX||0,pageY:_event.pageY||originalEvent.pageY||0};canvas.left-=(newWidth-width)*((center.pageX-offset.left-canvas.left)/width),canvas.top-=(newHeight-height)*((center.pageY-offset.top-canvas.top)/height)}else canvas.left-=(newWidth-width)/2,canvas.top-=(newHeight-height)/2;canvas.width=newWidth,canvas.height=newHeight,this.renderCanvas(!0)}},rotate:function(degree){this.rotateTo((this.image.rotate||0)+Number(degree))},rotateTo:function(degree){isNumber(degree=Number(degree))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.image.rotate=degree%360,this.rotated=!0,this.renderCanvas(!0))},scale:function(scaleX,scaleY){var image=this.image,changed=!1;isUndefined(scaleY)&&(scaleY=scaleX),scaleX=Number(scaleX),scaleY=Number(scaleY),this.ready&&!this.disabled&&this.options.scalable&&(isNumber(scaleX)&&(image.scaleX=scaleX,changed=!0),isNumber(scaleY)&&(image.scaleY=scaleY,changed=!0),changed&&this.renderImage(!0))},scaleX:function(_scaleX){var scaleY=this.image.scaleY;this.scale(_scaleX,isNumber(scaleY)?scaleY:1)},scaleY:function(_scaleY){var scaleX=this.image.scaleX;this.scale(isNumber(scaleX)?scaleX:1,_scaleY)},getData:function(isRounded){var options=this.options,image=this.image,canvas=this.canvas,cropBox=this.cropBox,ratio=void 0,data=void 0;return this.ready&&this.cropped?(data={x:cropBox.left-canvas.left,y:cropBox.top-canvas.top,width:cropBox.width,height:cropBox.height},ratio=image.width/image.naturalWidth,$.each(data,function(i,n){n/=ratio,data[i]=isRounded?Math.round(n):n})):data={x:0,y:0,width:0,height:0},options.rotatable&&(data.rotate=image.rotate||0),options.scalable&&(data.scaleX=image.scaleX||1,data.scaleY=image.scaleY||1),data},setData:function(data){var options=this.options,image=this.image,canvas=this.canvas,cropBoxData={},rotated=void 0,isScaled=void 0,ratio=void 0;$.isFunction(data)&&(data=data.call(this.element)),this.ready&&!this.disabled&&$.isPlainObject(data)&&(options.rotatable&&isNumber(data.rotate)&&data.rotate!==image.rotate&&(image.rotate=data.rotate,this.rotated=rotated=!0),options.scalable&&(isNumber(data.scaleX)&&data.scaleX!==image.scaleX&&(image.scaleX=data.scaleX,isScaled=!0),isNumber(data.scaleY)&&data.scaleY!==image.scaleY&&(image.scaleY=data.scaleY,isScaled=!0)),rotated?this.renderCanvas():isScaled&&this.renderImage(),ratio=image.width/image.naturalWidth,isNumber(data.x)&&(cropBoxData.left=data.x*ratio+canvas.left),isNumber(data.y)&&(cropBoxData.top=data.y*ratio+canvas.top),isNumber(data.width)&&(cropBoxData.width=data.width*ratio),isNumber(data.height)&&(cropBoxData.height=data.height*ratio),this.setCropBoxData(cropBoxData))},getContainerData:function(){return this.ready?this.container:{}},getImageData:function(){return this.loaded?this.image:{}},getCanvasData:function(){var canvas=this.canvas,data={};return this.ready&&$.each(["left","top","width","height","naturalWidth","naturalHeight"],function(i,n){data[n]=canvas[n]}),data},setCanvasData:function(data){var canvas=this.canvas,aspectRatio=canvas.aspectRatio;$.isFunction(data)&&(data=data.call(this.$element)),this.ready&&!this.disabled&&$.isPlainObject(data)&&(isNumber(data.left)&&(canvas.left=data.left),isNumber(data.top)&&(canvas.top=data.top),isNumber(data.width)?(canvas.width=data.width,canvas.height=data.width/aspectRatio):isNumber(data.height)&&(canvas.height=data.height,canvas.width=data.height*aspectRatio),this.renderCanvas(!0))},getCropBoxData:function(){var cropBox=this.cropBox;return this.ready&&this.cropped?{left:cropBox.left,top:cropBox.top,width:cropBox.width,height:cropBox.height}:{}},setCropBoxData:function(data){var cropBox=this.cropBox,aspectRatio=this.options.aspectRatio,widthChanged=void 0,heightChanged=void 0;$.isFunction(data)&&(data=data.call(this.$element)),this.ready&&this.cropped&&!this.disabled&&$.isPlainObject(data)&&(isNumber(data.left)&&(cropBox.left=data.left),isNumber(data.top)&&(cropBox.top=data.top),isNumber(data.width)&&data.width!==cropBox.width&&(widthChanged=!0,cropBox.width=data.width),isNumber(data.height)&&data.height!==cropBox.height&&(heightChanged=!0,cropBox.height=data.height),aspectRatio&&(widthChanged?cropBox.height=cropBox.width/aspectRatio:heightChanged&&(cropBox.width=cropBox.height*aspectRatio)),this.renderCropBox())},getCroppedCanvas:function(options){var self=this;if(!self.ready||!window.HTMLCanvasElement)return null;if(!self.cropped)return getSourceCanvas(self.$clone[0],self.image);$.isPlainObject(options)||(options={});var data=self.getData(),originalWidth=data.width,originalHeight=data.height,aspectRatio=originalWidth/originalHeight,scaledWidth=void 0,scaledHeight=void 0,scaledRatio=void 0;$.isPlainObject(options)&&(scaledWidth=options.width,scaledHeight=options.height,scaledWidth?(scaledHeight=scaledWidth/aspectRatio,scaledRatio=scaledWidth/originalWidth):scaledHeight&&(scaledWidth=scaledHeight*aspectRatio,scaledRatio=scaledHeight/originalHeight));var canvasWidth=Math.floor(scaledWidth||originalWidth),canvasHeight=Math.floor(scaledHeight||originalHeight),canvas=$("<canvas>")[0],context=canvas.getContext("2d");canvas.width=canvasWidth,canvas.height=canvasHeight,options.fillColor&&(context.fillStyle=options.fillColor,context.fillRect(0,0,canvasWidth,canvasHeight));var source,sourceWidth,sourceHeight,canvasData,params,srcX,srcY,srcWidth,srcHeight,dstX,dstY,dstWidth,dstHeight,parameters=(source=getSourceCanvas(self.$clone[0],self.image),sourceWidth=source.width,sourceHeight=source.height,canvasData=self.canvas,params=[source],srcX=data.x+canvasData.naturalWidth*(Math.abs(data.scaleX||1)-1)/2,srcY=data.y+canvasData.naturalHeight*(Math.abs(data.scaleY||1)-1)/2,srcWidth=void 0,srcHeight=void 0,dstX=void 0,dstY=void 0,dstWidth=void 0,dstHeight=void 0,srcX<=-originalWidth||srcX>sourceWidth?srcX=srcWidth=dstX=dstWidth=0:srcX<=0?(dstX=-srcX,srcX=0,srcWidth=dstWidth=Math.min(sourceWidth,originalWidth+srcX)):srcX<=sourceWidth&&(dstX=0,srcWidth=dstWidth=Math.min(originalWidth,sourceWidth-srcX)),srcWidth<=0||srcY<=-originalHeight||srcY>sourceHeight?srcY=srcHeight=dstY=dstHeight=0:srcY<=0?(dstY=-srcY,srcY=0,srcHeight=dstHeight=Math.min(sourceHeight,originalHeight+srcY)):srcY<=sourceHeight&&(dstY=0,srcHeight=dstHeight=Math.min(originalHeight,sourceHeight-srcY)),params.push(Math.floor(srcX),Math.floor(srcY),Math.floor(srcWidth),Math.floor(srcHeight)),scaledRatio&&(dstX*=scaledRatio,dstY*=scaledRatio,dstWidth*=scaledRatio,dstHeight*=scaledRatio),dstWidth>0&&dstHeight>0&&params.push(Math.floor(dstX),Math.floor(dstY),Math.floor(dstWidth),Math.floor(dstHeight)),params);return context.drawImage.apply(context,toConsumableArray(parameters)),canvas},setAspectRatio:function(aspectRatio){var options=this.options;this.disabled||isUndefined(aspectRatio)||(options.aspectRatio=Math.max(0,aspectRatio)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(mode){var options=this.options,croppable=void 0,movable=void 0;this.loaded&&!this.disabled&&(croppable="crop"===mode,movable=options.movable&&"move"===mode,mode=croppable||movable?mode:"none",this.$dragBox.data("action",mode).toggleClass("cropper-crop",croppable).toggleClass("cropper-move",movable),options.cropBoxMovable||this.$face.data("action",mode).toggleClass("cropper-crop",croppable).toggleClass("cropper-move",movable))}},CLASS_HIDDEN="cropper-hidden",REGEXP_DATA_URL=/^data:/,REGEXP_DATA_URL_JPEG=/^data:image\/jpeg;base64,/,Cropper=function(){function Cropper(element,options){classCallCheck(this,Cropper);this.$element=$(element),this.options=$.extend({},DEFAULTS,$.isPlainObject(options)&&options),this.loaded=!1,this.ready=!1,this.completed=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.replaced=!1,this.limited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.pointers={},this.init()}return createClass(Cropper,[{key:"init",value:function(){var $this=this.$element,url=void 0;if($this.is("img")){if(this.isImg=!0,this.originalUrl=url=$this.attr("src"),!url)return;url=$this.prop("src")}else $this.is("canvas")&&window.HTMLCanvasElement&&(url=$this[0].toDataURL());this.load(url)}},{key:"trigger",value:function(type,data){var e=$.Event(type,data);return this.$element.trigger(e),e}},{key:"load",value:function(url){var self=this,options=self.options,$this=self.$element;if(url)if(self.url=url,self.image={},options.checkOrientation&&window.ArrayBuffer)if(REGEXP_DATA_URL.test(url))REGEXP_DATA_URL_JPEG.test(url)?self.read(dataURLToArrayBuffer(url)):self.clone();else{var xhr=new XMLHttpRequest;xhr.onerror=xhr.onabort=$.proxy(function(){self.clone()},this),xhr.onload=function(){self.read(this.response)},options.checkCrossOrigin&&isCrossOriginURL(url)&&$this.prop("crossOrigin")&&(url=addTimestamp(url)),xhr.open("get",url),xhr.responseType="arraybuffer",xhr.withCredentials="use-credentials"===$this.prop("crossOrigin"),xhr.send()}else self.clone()}},{key:"read",value:function(arrayBuffer){var options=this.options,orientation=getOrientation(arrayBuffer),image=this.image,rotate=0,scaleX=1,scaleY=1;if(orientation>1)switch(this.url=arrayBufferToDataURL(arrayBuffer),orientation){case 2:scaleX=-1;break;case 3:rotate=-180;break;case 4:scaleY=-1;break;case 5:rotate=90,scaleY=-1;break;case 6:rotate=90;break;case 7:rotate=90,scaleX=-1;break;case 8:rotate=-90}options.rotatable&&(image.rotate=rotate),options.scalable&&(image.scaleX=scaleX,image.scaleY=scaleY),this.clone()}},{key:"clone",value:function(){var options=this.options,$this=this.$element,url=this.url,crossOrigin="",crossOriginUrl=void 0;options.checkCrossOrigin&&isCrossOriginURL(url)&&((crossOrigin=$this.prop("crossOrigin"))?crossOriginUrl=url:(crossOrigin="anonymous",crossOriginUrl=addTimestamp(url))),this.crossOrigin=crossOrigin,this.crossOriginUrl=crossOriginUrl;var image=document.createElement("img");crossOrigin&&(image.crossOrigin=crossOrigin),image.src=crossOriginUrl||url;var $clone=$(image);this.$clone=$clone,this.isImg?$this[0].complete?this.start():$this.one("load",$.proxy(this.start,this)):$clone.one("load",$.proxy(this.start,this)).one("error",$.proxy(this.stop,this)).addClass("cropper-hide").insertAfter($this)}},{key:"start",value:function(){var self=this,$clone=self.$clone,$image=self.$element;self.isImg||($clone.off("error",self.stop),$image=$clone),getImageSize($image[0],function(naturalWidth,naturalHeight){$.extend(self.image,{naturalWidth,naturalHeight,aspectRatio:naturalWidth/naturalHeight}),self.loaded=!0,self.build()})}},{key:"stop",value:function(){this.$clone.remove(),this.$clone=null}},{key:"build",value:function(){var self=this,options=self.options,$this=self.$element,$clone=self.$clone,$cropper=void 0,$cropBox=void 0,$face=void 0;self.loaded&&(self.ready&&self.unbuild(),self.$container=$this.parent(),self.$cropper=$cropper=$(TEMPLATE),self.$canvas=$cropper.find(".cropper-canvas").append($clone),self.$dragBox=$cropper.find(".cropper-drag-box"),self.$cropBox=$cropBox=$cropper.find(".cropper-crop-box"),self.$viewBox=$cropper.find(".cropper-view-box"),self.$face=$face=$cropBox.find(".cropper-face"),$this.addClass(CLASS_HIDDEN).after($cropper),self.isImg||$clone.removeClass("cropper-hide"),self.initPreview(),self.bind(),options.aspectRatio=Math.max(0,options.aspectRatio)||NaN,options.viewMode=Math.max(0,Math.min(3,Math.round(options.viewMode)))||0,self.cropped=options.autoCrop,options.autoCrop?options.modal&&self.$dragBox.addClass("cropper-modal"):$cropBox.addClass(CLASS_HIDDEN),options.guides||$cropBox.find(".cropper-dashed").addClass(CLASS_HIDDEN),options.center||$cropBox.find(".cropper-center").addClass(CLASS_HIDDEN),options.cropBoxMovable&&$face.addClass("cropper-move").data("action","all"),options.highlight||$face.addClass("cropper-invisible"),options.background&&$cropper.addClass("cropper-bg"),options.cropBoxResizable||$cropBox.find(".cropper-line, .cropper-point").addClass(CLASS_HIDDEN),self.setDragMode(options.dragMode),self.render(),self.ready=!0,self.setData(options.data),self.completing=setTimeout(function(){$.isFunction(options.ready)&&$this.one("ready",options.ready),self.trigger("ready"),self.trigger("crop",self.getData()),self.completed=!0},0))}},{key:"unbuild",value:function(){this.ready&&(this.completed||clearTimeout(this.completing),this.ready=!1,this.completed=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}],[{key:"setDefaults",value:function(options){$.extend(DEFAULTS,$.isPlainObject(options)&&options)}}]),Cropper}();$.extend(Cropper.prototype,render$1),$.extend(Cropper.prototype,preview$1),$.extend(Cropper.prototype,events),$.extend(Cropper.prototype,handlers),$.extend(Cropper.prototype,change$1),$.extend(Cropper.prototype,methods);var NAMESPACE="cropper",OtherCropper=$.fn.cropper;$.fn.cropper=function(option){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];var result=void 0;return this.each(function(i,element){var $this=$(element),data=$this.data(NAMESPACE);if(!data){if(/destroy/.test(option))return;var options=$.extend({},$this.data(),$.isPlainObject(option)&&option);$this.data(NAMESPACE,data=new Cropper(element,options))}if("string"==typeof option){var fn=data[option];$.isFunction(fn)&&(result=fn.apply(data,args))}}),void 0!==result?result:this},$.fn.cropper.Constructor=Cropper,$.fn.cropper.setDefaults=Cropper.setDefaults,$.fn.cropper.noConflict=function(){return $.fn.cropper=OtherCropper,this};